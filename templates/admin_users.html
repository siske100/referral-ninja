{% extends "base.html" %}

{% block title %}User Management - ReferralNinja{% endblock %}

{% block content %}
<div class="container-fluid px-3 px-md-4">
    <!-- Enhanced Header -->
    <div class="dashboard-header">
        <div class="header-background">
            <div class="container-fluid">
                <div class="row align-items-center py-3 py-md-4">
                    <div class="col-md-8">
                        <div class="d-flex align-items-center">
                            <div class="header-icon-container me-3 me-md-4">
                                <div class="icon-wrapper bg-white shadow">
                                    <i class="fas fa-users-cog text-primary"></i>
                                </div>
                            </div>
                            <div class="header-text">
                                <h1 class="display-heading fw-bold text-white mb-1 mb-md-2">User Management</h1>
                                <p class="text-white-50 mb-0 subheading">Comprehensive user administration and analytics</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 text-md-end mt-2 mt-md-0">
                        <div class="status-indicator">
                            <span class="status-badge bg-white text-primary">
                                <i class="fas fa-circle text-success me-2 pulse"></i>
                                <span class="status-text">Live Dashboard â€¢ Real-time Updates</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Statistics Cards -->
    <div class="row mt-3 mt-md-4 g-3">
        <div class="col-xl-3 col-md-6">
            <div class="metric-card total-users-gradient">
                <div class="card-body">
                    <div class="metric-content">
                        <div class="metric-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="metric-data">
                            <h3 class="metric-value">{{ users|length }}</h3>
                            <p class="metric-label">Total Users</p>
                            <div class="metric-trend positive">
                                <i class="fas fa-chart-line me-1"></i>
                                <span>All Time</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="metric-card verified-gradient">
                <div class="card-body">
                    <div class="metric-content">
                        <div class="metric-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="metric-data">
                            <h3 class="metric-value">{{ users|selectattr('is_verified')|list|length }}</h3>
                            <p class="metric-label">Verified Users</p>
                            <div class="metric-trend positive">
                                <i class="fas fa-shield-check me-1"></i>
                                <span>{{ "%.1f"|format((users|selectattr('is_verified')|list|length / users|length * 100) if users|length > 0 else 0) }}% Rate</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="metric-card active-gradient">
                <div class="card-body">
                    <div class="metric-content">
                        <div class="metric-icon">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div class="metric-data">
                            <h3 class="metric-value">{{ users|selectattr('is_active')|list|length }}</h3>
                            <p class="metric-label">Active Users</p>
                            <div class="metric-trend positive">
                                <i class="fas fa-rocket me-1"></i>
                                <span>{{ "%.1f"|format((users|selectattr('is_active')|list|length / users|length * 100) if users|length > 0 else 0) }}% Active</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="metric-card pending-gradient">
                <div class="card-body">
                    <div class="metric-content">
                        <div class="metric-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="metric-data">
                            <h3 class="metric-value">{{ users|rejectattr('is_verified')|list|length }}</h3>
                            <p class="metric-label">Pending Verification</p>
                            <div class="metric-trend neutral">
                                <i class="fas fa-exclamation-circle me-1"></i>
                                <span>Requires Action</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Bar -->
    <div class="action-bar my-3 my-md-4">
        <div class="row g-2 g-md-3">
            <div class="col-md-8">
                <div class="d-flex gap-2 flex-wrap">
                    <button class="btn btn-success btn-action" onclick="showAddUserModal()">
                        <i class="fas fa-user-plus me-1 me-md-2"></i>
                        <span class="btn-text">Add User</span>
                    </button>

                    <button class="btn btn-outline-secondary btn-action" onclick="refreshData()">
                        <i class="fas fa-sync-alt me-1 me-md-2"></i>
                        <span class="btn-text">Refresh</span>
                    </button>
                </div>
            </div>
            <div class="col-md-4 text-end">
                <div class="d-flex gap-2 justify-content-end flex-wrap">
                    <span class="badge bg-light text-dark align-self-center">
                        <i class="fas fa-database me-1"></i>{{ users|length }} Total
                    </span>
                    <button class="btn btn-outline-info btn-action" onclick="showAnalytics()">
                        <i class="fas fa-chart-bar me-1 me-md-2"></i>
                        <span class="btn-text">Analytics</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Search and Filter Section -->
    <div class="dashboard-card mb-3 mb-md-4">
        <div class="card-header">
            <div class="d-flex justify-content-between align-items-center flex-column flex-md-row gap-2 gap-md-0">
                <h5 class="mb-0 card-title">
                    <i class="fas fa-search me-1 me-md-2"></i>Search & Filter Users
                </h5>
                <button class="btn btn-sm btn-outline-secondary" onclick="clearAllFilters()">
                    <i class="fas fa-times me-1"></i>Clear All
                </button>
            </div>
        </div>
        <div class="card-body">
            <div class="row g-2 g-md-3">
                <div class="col-12 col-md-6">
                    <div class="search-box">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="form-control search-input" id="searchInput" 
                               placeholder="Search by username, email, phone, or referral code..." 
                               onkeyup="debouncedSearch()">
                        <button class="btn btn-sm btn-outline-secondary search-clear" onclick="clearSearch()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <select class="form-select form-select-sm" id="statusFilter" onchange="applyFilters()">
                        <option value="">All Statuses</option>
                        <option value="verified">Verified Only</option>
                        <option value="unverified">Unverified Only</option>
                        <option value="active">Active Only</option>
                        <option value="inactive">Inactive Only</option>
                        <option value="admin">Admins Only</option>
                    </select>
                </div>
                <div class="col-6 col-md-3">
                    <select class="form-select form-select-sm" id="rankFilter" onchange="applyFilters()">
                        <option value="">All Ranks</option>
                        <option value="bronze">Bronze</option>
                        <option value="silver">Silver</option>
                        <option value="gold">Gold</option>
                        <option value="platinum">Platinum</option>
                    </select>
                </div>
            </div>

            <!-- Advanced Filters -->
            <div class="advanced-filters mt-2 mt-md-3">
                <a class="btn btn-sm btn-outline-primary" data-bs-toggle="collapse" href="#advancedFilters">
                    <i class="fas fa-sliders-h me-1 me-md-2"></i>Advanced Filters
                    <i class="fas fa-chevron-down ms-1"></i>
                </a>
                
                <div class="collapse mt-2 mt-md-3" id="advancedFilters">
                    <div class="row g-2 g-md-3">
                        <div class="col-12 col-md-3">
                            <label class="form-label small fw-bold">Date Range</label>
                            <div class="input-group input-group-sm">
                                <input type="date" class="form-control form-control-sm" id="dateFrom" onchange="applyFilters()">
                                <span class="input-group-text">to</span>
                                <input type="date" class="form-control form-control-sm" id="dateTo" onchange="applyFilters()">
                            </div>
                        </div>
                        <div class="col-6 col-md-2">
                            <label class="form-label small fw-bold">Min Balance</label>
                            <input type="number" class="form-control form-control-sm" id="minBalance" placeholder="0.00" onchange="applyFilters()">
                        </div>
                        <div class="col-6 col-md-2">
                            <label class="form-label small fw-bold">Min Referrals</label>
                            <input type="number" class="form-control form-control-sm" id="minReferrals" placeholder="0" onchange="applyFilters()">
                        </div>
                        <div class="col-8 col-md-3">
                            <label class="form-label small fw-bold">Sort By</label>
                            <select class="form-select form-select-sm" id="sortBy" onchange="applyFilters()">
                                <option value="newest">Newest First</option>
                                <option value="oldest">Oldest First</option>
                                <option value="balance_high">Balance: High to Low</option>
                                <option value="balance_low">Balance: Low to High</option>
                                <option value="referrals_high">Referrals: High to Low</option>
                                <option value="referrals_low">Referrals: Low to High</option>
                            </select>
                        </div>
                        <div class="col-4 col-md-2 d-flex align-items-end">
                            <button class="btn btn-sm btn-outline-danger w-100" onclick="clearAdvancedFilters()">
                                <i class="fas fa-times me-1"></i>Reset
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Users Table -->
    <div class="dashboard-card">
        <div class="card-header">
            <div class="d-flex justify-content-between align-items-center flex-column flex-md-row gap-2 gap-md-0">
                <h5 class="mb-0 card-title">
                    <i class="fas fa-user-friends me-1 me-md-2"></i>User Management
                    <span class="badge bg-primary ms-1 ms-md-2" id="userCount">{{ users|length }}</span>
                </h5>
                <div class="d-flex gap-2 align-items-center flex-wrap justify-content-center">
                    <span class="text-muted small" id="showingText">
                        Showing {{ users|length }} of {{ users|length }} users
                    </span>
                    <button class="btn btn-sm btn-outline-success" onclick="exportUsers()">
                        <i class="fas fa-file-export me-1"></i>Export
                    </button>
                </div>
            </div>
        </div>
        
        <div class="card-body p-0">
            {% if users %}
                <div class="table-responsive">
                    <table class="users-table" id="usersTable">
                        <thead>
                            <tr>
                                <th class="user-info-col">User Information</th>
                                <th class="contact-col">Contact Details</th>
                                <th class="financial-col">Financial Stats</th>
                                <th class="status-col">Account Status</th>
                                <th class="registration-col">Registration</th>
                                <th class="actions-col">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            {% for user in users %}
                            <tr class="user-row" 
                                data-user-id="{{ user.id }}"
                                data-referral="{{ user.referral_code|lower if user.referral_code else '' }}"
                                data-username="{{ user.username|lower if user.username else '' }}"
                                data-email="{{ user.email|lower if user.email else '' }}"
                                data-phone="{{ user.phone_number|lower if user.phone_number else '' }}"
                                data-balance="{{ user.balance if user.balance is not none else 0 }}"
                                data-referrals="{{ user.referral_count if user.referral_count is not none else 0 }}"
                                data-rank="{{ user.user_rank|lower if user.user_rank else '' }}"
                                data-joined="{% if user.created_at %}{{ user.created_at.strftime('%Y-%m-%d') }}{% endif %}"
                                data-status="{% if user.is_verified %}verified{% else %}unverified{% endif %} {% if user.is_active %}active{% else %}inactive{% endif %} {% if user.is_admin %}admin{% endif %}">
                                
                                <td class="user-info-col">
                                    <div class="user-info">
                                        <div class="user-main">
                                            <span class="user-avatar">
                                                {{ (user.username[0] if user.username else 'U')|upper }}
                                            </span>
                                            <div class="user-details">
                                                <div class="username fw-bold">{{ user.username if user.username else 'N/A' }}</div>
                                                <div class="user-ref">
                                                    <small class="text-muted">Ref: </small>
                                                    <code class="referral-code">{{ user.referral_code if user.referral_code else 'N/A' }}</code>
                                                </div>
                                            </div>
                                        </div>
                                        {% if user.referred_by %}
                                        <div class="referred-by">
                                            <small class="text-info">
                                                <i class="fas fa-user-friends me-1"></i>Referred by: {{ user.referred_by }}
                                            </small>
                                        </div>
                                        {% endif %}
                                    </div>
                                </td>
                                
                                <td class="contact-col">
                                    <div class="contact-info">
                                        <div class="contact-item">
                                            <i class="fas fa-envelope text-muted me-1 me-md-2"></i>
                                            <span class="user-email">{{ user.email if user.email else 'N/A' }}</span>
                                        </div>
                                        <div class="contact-item">
                                            <i class="fas fa-phone text-muted me-1 me-md-2"></i>
                                            <span class="user-phone">{{ user.phone_number if user.phone_number else 'N/A' }}</span>
                                        </div>
                                    </div>
                                </td>
                                
                                <td class="financial-col">
                                    <div class="financial-stats">
                                        <div class="stat-item">
                                            <span class="stat-value text-success fw-bold">
                                                Ksh {{ "%.2f"|format(user.balance) if user.balance is not none else "0.00" }}
                                            </span>
                                            <small class="stat-label">Balance</small>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-value">
                                                <span class="badge bg-info user-referrals">{{ user.referral_count if user.referral_count is not none else 0 }}</span>
                                            </span>
                                            <small class="stat-label">Referrals</small>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-value text-primary fw-bold">
                                                Ksh {{ "%.2f"|format(user.total_commission) if user.total_commission is not none else "0.00" }}
                                            </span>
                                            <small class="stat-label">Total Commission</small>
                                        </div>
                                    </div>
                                </td>
                                
                                <td class="status-col">
                                    <div class="status-badges">
                                        <div class="badge-group">
                                            {% if user.is_verified %}
                                                <span class="badge bg-success">
                                                    <i class="fas fa-check-circle me-1"></i>Verified
                                                </span>
                                            {% else %}
                                                <span class="badge bg-warning text-dark">
                                                    <i class="fas fa-clock me-1"></i>Unverified
                                                </span>
                                            {% endif %}
                                            
                                            {% if user.is_active %}
                                                <span class="badge bg-success">
                                                    <i class="fas fa-play-circle me-1"></i>Active
                                                </span>
                                            {% else %}
                                                <span class="badge bg-danger">
                                                    <i class="fas fa-pause-circle me-1"></i>Inactive
                                                </span>
                                            {% endif %}
                                        </div>
                                        <div class="user-rank mt-1">
                                            <span class="badge bg-secondary">
                                                <i class="fas fa-trophy me-1"></i>{{ user.user_rank if user.user_rank else 'Bronze' }}
                                            </span>
                                        </div>
                                    </div>
                                </td>
                                
                                <td class="registration-col">
                                    <div class="registration-info">
                                        <div class="join-date fw-semibold">
                                            {% if user.created_at %}
                                                {{ user.created_at.strftime('%Y-%m-%d') }}
                                            {% else %}
                                                N/A
                                            {% endif %}
                                        </div>
                                        <small class="text-muted">
                                            {% if user.created_at %}
                                                {{ user.created_at.strftime('%H:%M') }}
                                            {% else %}
                                                N/A
                                            {% endif %}
                                        </small>
                                    </div>
                                </td>
                                
                                <td class="actions-col">
                                    <div class="action-buttons">
                                        {% if not user.is_admin %}
                                        <div class="btn-group-vertical btn-group-sm w-100">
                                            <button class="btn btn-outline-primary btn-sm" 
                                                    onclick="showUserDetails('{{ user.id }}')"
                                                    title="View Details">
                                                <i class="fas fa-eye"></i> <span class="d-none d-sm-inline">View</span>
                                            </button>
                                            <div class="btn-group btn-group-sm mt-1">
                                                <button class="btn btn-{{ 'warning' if user.is_active else 'success' }}" 
                                                        onclick="toggleUserStatus('{{ user.id }}')"
                                                        title="{{ 'Deactivate' if user.is_active else 'Activate' }}">
                                                    <i class="fas fa-{{ 'user-slash' if user.is_active else 'user-check' }}"></i>
                                                </button>
                                            </div>
                                        </div>
                                        {% else %}
                                        <span class="badge bg-dark">
                                            <i class="fas fa-crown me-1"></i>Admin
                                        </span>
                                        {% endif %}
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <!-- No Results Message -->
                <div id="noResults" class="empty-state text-center py-5" style="display: none;">
                    <div class="empty-icon mb-3">
                        <i class="fas fa-search fa-3x text-muted"></i>
                    </div>
                    <h5 class="text-muted mb-2">No Users Found</h5>
                    <p class="text-muted mb-3">No users match your current search criteria</p>
                    <button class="btn btn-primary" onclick="clearAllFilters()">
                        <i class="fas fa-times me-1"></i> Clear All Filters
                    </button>
                </div>
                
            {% else %}
                <div class="empty-state text-center py-5">
                    <div class="empty-icon mb-3">
                        <i class="fas fa-users fa-3x text-muted"></i>
                    </div>
                    <h5 class="text-muted mb-2">No Users Found</h5>
                    <p class="text-muted mb-3">There are no users in the system yet</p>
                    <button class="btn btn-primary" onclick="showAddUserModal()">
                        <i class="fas fa-user-plus me-1"></i> Add First User
                    </button>
                </div>
            {% endif %}
        </div>
        
        <!-- Table Footer -->
        {% if users %}
        <div class="card-footer">
            <div class="d-flex justify-content-between align-items-center flex-column flex-md-row gap-2 gap-md-0">
                <div class="text-muted small">
                    Showing <span id="showingCount">0</span> of <span id="totalCount">{{ users|length }}</span> users
                </div>
                <nav>
                    <ul class="pagination mb-0 pagination-sm" id="paginationControls">
                        <!-- Pagination will be generated by JavaScript -->
                    </ul>
                </nav>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- User Detail Modal -->
<div class="modal fade" id="userDetailModal" tabindex="-1" aria-labelledby="userDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="userDetailModalLabel">
                    <i class="fas fa-user me-2"></i>User Details
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="userDetailContent">
                <!-- User details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Add User Modal -->
<div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addUserModalLabel">
                    <i class="fas fa-user-plus me-2"></i>Add New User
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="mb-3">
                        <label for="newUsername" class="form-label">Username</label>
                        <input type="text" class="form-control" id="newUsername" required>
                    </div>
                    <div class="mb-3">
                        <label for="newEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="newEmail" required>
                    </div>
                    <div class="mb-3">
                        <label for="newPhone" class="form-label">Phone Number</label>
                        <input type="tel" class="form-control" id="newPhone">
                    </div>
                    <div class="mb-3">
                        <label for="newPassword" class="form-label">Password</label>
                        <input type="password" class="form-control" id="newPassword" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="addNewUser()">Add User</button>
            </div>
        </div>
    </div>
</div>

<!-- Loading Spinner -->
<div id="loadingSpinner" class="loading-overlay">
    <div class="spinner-container">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2 text-muted">Processing...</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// ... (JavaScript code remains exactly the same as in your original) ...
</script>

<style>
/* Enhanced Professional Styling with Clamp-based Responsive Design */

:root {
    --primary-color: #2c3e50;
    --secondary-color: #34495e;
    --accent-color: #3498db;
    --success-color: #27ae60;
    --warning-color: #f39c12;
    --danger-color: #e74c3c;
    --info-color: #2980b9;
    
    /* Responsive font sizes using clamp */
    --font-xs: clamp(0.75rem, 0.7rem + 0.25vw, 0.875rem);
    --font-sm: clamp(0.875rem, 0.8rem + 0.375vw, 1rem);
    --font-base: clamp(1rem, 0.9rem + 0.5vw, 1.125rem);
    --font-lg: clamp(1.125rem, 1rem + 0.625vw, 1.25rem);
    --font-xl: clamp(1.25rem, 1.1rem + 0.75vw, 1.5rem);
    --font-2xl: clamp(1.5rem, 1.3rem + 1vw, 2rem);
    --font-3xl: clamp(2rem, 1.7rem + 1.5vw, 2.5rem);
    
    /* Responsive spacing */
    --space-xs: clamp(0.25rem, 0.2rem + 0.25vw, 0.5rem);
    --space-sm: clamp(0.5rem, 0.4rem + 0.5vw, 0.75rem);
    --space-md: clamp(0.75rem, 0.6rem + 0.75vw, 1rem);
    --space-lg: clamp(1rem, 0.8rem + 1vw, 1.5rem);
    --space-xl: clamp(1.5rem, 1.2rem + 1.5vw, 2rem);
    --space-2xl: clamp(2rem, 1.6rem + 2vw, 3rem);
}

/* Enhanced Header */
.dashboard-header {
    margin-bottom: var(--space-lg);
}

.header-background {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.header-icon-container .icon-wrapper {
    width: clamp(3rem, 2.5rem + 2.5vw, 4rem);
    height: clamp(3rem, 2.5rem + 2.5vw, 4rem);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.header-icon-container i {
    font-size: clamp(1.25rem, 1rem + 1.25vw, 1.75rem);
}

.display-heading {
    font-size: var(--font-3xl);
    line-height: 1.2;
}

.subheading {
    font-size: var(--font-sm);
}

.status-badge {
    padding: var(--space-sm) var(--space-md);
    border-radius: 50px;
    font-size: var(--font-xs);
    font-weight: 600;
}

/* Enhanced Metric Cards */
.metric-card {
    border: none;
    border-radius: 12px;
    box-shadow: 0 2px 15px rgba(0,0,0,0.08);
    transition: all 0.3s ease;
    height: 100%;
    min-height: 120px;
}

.metric-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 25px rgba(0,0,0,0.12);
}

.metric-content {
    display: flex;
    align-items: center;
    height: 100%;
}

.metric-icon {
    width: clamp(3rem, 2.5rem + 2.5vw, 4rem);
    height: clamp(3rem, 2.5rem + 2.5vw, 4rem);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: var(--space-md);
    background: rgba(255,255,255,0.2);
}

.metric-icon i {
    font-size: clamp(1.25rem, 1rem + 1.25vw, 1.75rem);
    color: white;
}

.metric-value {
    font-size: var(--font-2xl);
    font-weight: 700;
    margin-bottom: var(--space-xs);
    line-height: 1;
}

.metric-label {
    font-size: var(--font-sm);
    font-weight: 600;
    margin-bottom: var(--space-xs);
    opacity: 0.9;
}

.metric-trend {
    font-size: var(--font-xs);
    display: flex;
    align-items: center;
}

/* Gradient backgrounds for metric cards */
.total-users-gradient {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.verified-gradient {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
}

.active-gradient {
    background: linear-gradient(135deg, #fc466b 0%, #3f5efb 100%);
    color: white;
}

.pending-gradient {
    background: linear-gradient(135deg, #fdbb2d 0%, #22c1c3 100%);
    color: white;
}

/* Enhanced Action Bar */
.action-bar {
    background: white;
    padding: var(--space-md);
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
}

.btn-action {
    padding: var(--space-sm) var(--space-md);
    font-size: var(--font-sm);
    font-weight: 600;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.btn-action .btn-text {
    font-size: inherit;
}

/* Enhanced Search Box */
.search-box {
    position: relative;
    display: flex;
    align-items: center;
}

.search-icon {
    position: absolute;
    left: var(--space-md);
    color: #6c757d;
    z-index: 3;
}

.search-input {
    padding-left: calc(var(--space-md) * 2.5);
    padding-right: calc(var(--space-md) * 2.5);
    border-radius: 8px;
    border: 1px solid #e9ecef;
    font-size: var(--font-sm);
    height: calc(2.5rem + 0.5vw);
}

.search-input:focus {
    border-color: var(--accent-color);
    box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
}

.search-clear {
    position: absolute;
    right: var(--space-sm);
    z-index: 3;
    border: none;
    background: transparent;
    color: #6c757d;
}

/* Enhanced Table */
.dashboard-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 15px rgba(0,0,0,0.08);
    border: none;
    overflow: hidden;
}

.card-header {
    background: white;
    border-bottom: 1px solid #e9ecef;
    padding: var(--space-lg);
}

.card-title {
    font-size: var(--font-lg);
    font-weight: 600;
    color: var(--primary-color);
}

.table-responsive {
    overflow-x: auto;
}

.users-table {
    width: 100%;
    border-collapse: collapse;
    font-size: var(--font-sm);
}

.users-table th {
    background: #f8f9fa;
    padding: var(--space-md);
    font-weight: 600;
    color: var(--primary-color);
    border-bottom: 2px solid #e9ecef;
    white-space: nowrap;
}

.users-table td {
    padding: var(--space-md);
    border-bottom: 1px solid #e9ecef;
    vertical-align: top;
}

.user-row:hover {
    background-color: #f8f9fa;
}

/* Enhanced User Info */
.user-info {
    min-width: 150px;
}

.user-main {
    display: flex;
    align-items: center;
    gap: var(--space-md);
}

.user-avatar {
    width: clamp(2.5rem, 2rem + 2.5vw, 3rem);
    height: clamp(2.5rem, 2rem + 2.5vw, 3rem);
    border-radius: 50%;
    background: var(--accent-color);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: var(--font-sm);
    flex-shrink: 0;
}

.user-details {
    flex: 1;
    min-width: 0;
}

.username {
    font-size: var(--font-base);
    color: var(--primary-color);
    margin-bottom: var(--space-xs);
    word-break: break-word;
}

.user-ref {
    font-size: var(--font-xs);
}

.referral-code {
    background: #f8f9fa;
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
}

.referred-by {
    margin-top: var(--space-xs);
}

/* Enhanced Contact Info */
.contact-info {
    min-width: 180px;
}

.contact-item {
    display: flex;
    align-items: center;
    margin-bottom: var(--space-xs);
    font-size: var(--font-sm);
}

.contact-item:last-child {
    margin-bottom: 0;
}

/* Enhanced Financial Stats */
.financial-stats {
    min-width: 140px;
}

.stat-item {
    margin-bottom: var(--space-sm);
    text-align: center;
}

.stat-item:last-child {
    margin-bottom: 0;
}

.stat-value {
    font-size: var(--font-sm);
    display: block;
}

.stat-label {
    color: #6c757d;
    font-size: var(--font-xs);
}

/* Enhanced Status Badges */
.status-badges {
    min-width: 120px;
}

.badge-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
}

.badge {
    font-size: var(--font-xs);
    padding: var(--space-xs) var(--space-sm);
    border-radius: 6px;
    font-weight: 600;
}

/* Enhanced Action Buttons */
.action-buttons {
    min-width: 80px;
}

.btn-group-vertical .btn {
    font-size: var(--font-xs);
    padding: var(--space-xs) var(--space-sm);
}

/* Enhanced Empty State */
.empty-state {
    padding: var(--space-2xl);
}

.empty-icon {
    opacity: 0.5;
}

/* Enhanced Loading Overlay */
.loading-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255,255,255,0.9);
    z-index: 9999;
    align-items: center;
    justify-content: center;
}

.spinner-container {
    text-align: center;
}

/* Enhanced Pagination */
.pagination {
    gap: var(--space-xs);
}

.page-link {
    padding: var(--space-sm) var(--space-md);
    border-radius: 6px;
    font-size: var(--font-sm);
    border: 1px solid #e9ecef;
}

/* Enhanced Form Controls */
.form-control, .form-select {
    border-radius: 8px;
    border: 1px solid #e9ecef;
    font-size: var(--font-sm);
    padding: var(--space-sm) var(--space-md);
}

.form-control:focus, .form-select:focus {
    border-color: var(--accent-color);
    box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
}

/* Enhanced Modal */
.modal-content {
    border-radius: 12px;
    border: none;
    box-shadow: 0 10px 50px rgba(0,0,0,0.2);
}

.modal-header {
    border-bottom: 1px solid #e9ecef;
    padding: var(--space-lg);
}

.modal-body {
    padding: var(--space-lg);
}

.modal-footer {
    border-top: 1px solid #e9ecef;
    padding: var(--space-lg);
}

/* Pulse Animation for Live Status */
@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

.pulse {
    animation: pulse 2s infinite;
}

/* Responsive Table Columns */
@media (max-width: 1200px) {
    .users-table th:nth-child(3),
    .users-table td:nth-child(3) {
        display: none;
    }
}

@media (max-width: 992px) {
    .users-table th:nth-child(5),
    .users-table td:nth-child(5) {
        display: none;
    }
    
    .user-main {
        flex-direction: column;
        align-items: flex-start;
        gap: var(--space-sm);
    }
}

@media (max-width: 768px) {
    .users-table th:nth-child(2),
    .users-table td:nth-child(2) {
        display: none;
    }
    
    .metric-content {
        flex-direction: column;
        text-align: center;
    }
    
    .metric-icon {
        margin-right: 0;
        margin-bottom: var(--space-md);
    }
    
    .header-text {
        text-align: center;
    }
    
    .header-icon-container {
        margin-right: 0 !important;
        margin-bottom: var(--space-md);
    }
}

@media (max-width: 576px) {
    .users-table th:nth-child(4),
    .users-table td:nth-child(4) {
        display: none;
    }
    
    .container-fluid {
        padding-left: var(--space-sm);
        padding-right: var(--space-sm);
    }
    
    .card-header, .card-body, .card-footer {
        padding: var(--space-md);
    }
}

/* Print Styles */
@media print {
    .action-bar, .card-header .btn, .action-buttons {
        display: none !important;
    }
    
    .dashboard-card {
        box-shadow: none !important;
        border: 1px solid #ddd !important;
    }
}
</style>
{% endblock %}
